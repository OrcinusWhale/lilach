<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<AnchorPane fx:id="rootPane" prefHeight="720.0" prefWidth="900.0" xmlns="http://javafx.com/javafx/24.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="il.cshaifasweng.OCSFMediatorExample.client.ItemPageController" stylesheets="@itemPage.css">
    <children>
        <VBox spacing="16" AnchorPane.topAnchor="0" AnchorPane.leftAnchor="0" AnchorPane.rightAnchor="0" AnchorPane.bottomAnchor="0" styleClass="root-container">
            <!-- Top Bar -->
            <HBox spacing="12" alignment="CENTER_LEFT" styleClass="top-bar">
                <Button fx:id="backBtn" mnemonicParsing="false" onAction="#backToCatalogue" text="Back" styleClass="secondary-button" />
                <Label fx:id="nameLabel" text="Loading..." styleClass="title-label" HBox.hgrow="ALWAYS" maxWidth="1.7976931348623157E308">
                    <font><Font size="32"/></font>
                </Label>
                <TextField fx:id="nameTF" alignment="CENTER" disable="true" visible="false" styleClass="title-edit-field" HBox.hgrow="ALWAYS" />
            </HBox>

            <HBox fx:id="contentFlow" spacing="24" VBox.vgrow="ALWAYS" styleClass="content-hbox">
                <!-- Left Column: Image -->
                <StackPane styleClass="image-wrapper" prefWidth="420" minWidth="300">
                    <ImageView fx:id="imageView" preserveRatio="true" fitWidth="400" fitHeight="400" />
                </StackPane>

                <!-- Right Column: Details & Actions -->
                <VBox spacing="8" prefWidth="360" minWidth="300" fillWidth="true" styleClass="details-column">
                    <GridPane hgap="6" vgap="6" styleClass="details-grid">
                        <columnConstraints>
                            <ColumnConstraints halignment="LEFT" hgrow="NEVER" />
                            <ColumnConstraints hgrow="ALWAYS" />
                        </columnConstraints>
                        <rowConstraints>
                            <RowConstraints vgrow="NEVER" /> <!-- 0 ID -->
                            <RowConstraints vgrow="NEVER" /> <!-- 1 Type -->
                            <RowConstraints vgrow="NEVER" /> <!-- 2 Price -->
                            <RowConstraints vgrow="NEVER" /> <!-- 3 Sale label -->
                            <RowConstraints vgrow="NEVER" /> <!-- 4 Sale edit controls -->
                            <RowConstraints vgrow="NEVER" /> <!-- 5 Error -->
                            <RowConstraints vgrow="NEVER" /> <!-- 6 Image controls -->
                        </rowConstraints>
                        <!-- ID -->
                        <Label text="Item ID:" visible="false" fx:id="idLabel" GridPane.rowIndex="0" GridPane.columnSpan="2" styleClass="meta-label" />
                        <!-- Type: static label + value label (view) or text field (edit) -->
                        <Label fx:id="typeLabel" text="Type:" visible="false" GridPane.rowIndex="1" GridPane.columnIndex="0" styleClass="meta-label" />
                        <Label fx:id="typeValueLabel" text="" visible="false" GridPane.rowIndex="1" GridPane.columnIndex="1" />
                        <TextField fx:id="typeTF" disable="true" visible="false" promptText="Type" GridPane.rowIndex="1" GridPane.columnIndex="1" />
                        <!-- Price: static label col0, dynamic value label & editable field share col1 -->
                        <Label fx:id="priceLabel" text="Price:" visible="false" GridPane.rowIndex="2" GridPane.columnIndex="0" />
                        <Label fx:id="priceValueLabel" text="" visible="false" GridPane.rowIndex="2" GridPane.columnIndex="1" styleClass="price-label" stylesheets="@strikethrough.css" />
                        <TextField fx:id="priceTF" disable="true" visible="false" promptText="Price" prefWidth="110" GridPane.rowIndex="2" GridPane.columnIndex="1" />
                        <!-- SALE label -->
                        <Label fx:id="saleLabel" text="SALE:" textFill="RED" visible="false" GridPane.rowIndex="3" GridPane.columnSpan="2" />
                        <!-- Sale editing controls -->
                        <HBox spacing="6" alignment="CENTER_LEFT" GridPane.rowIndex="4" GridPane.columnSpan="2">
                            <CheckBox fx:id="saleCheck" text="Sale:" disable="true" visible="false" onAction="#toggleSale" />
                            <TextField fx:id="saleTF" disable="true" visible="false" promptText="Sale" prefWidth="90" />
                        </HBox>
                        <!-- Error label -->
                        <Label fx:id="priceErrorLabel" text="Invalid price" textFill="RED" visible="false" GridPane.rowIndex="5" GridPane.columnSpan="2" />
                        <!-- Image change section -->
                        <HBox spacing="6" alignment="CENTER_LEFT" GridPane.rowIndex="6" GridPane.columnSpan="2">
                            <CheckBox fx:id="imageCheck" text="Image:" disable="true" visible="false" onAction="#toggleBrowse" selected="true" />
                            <Button fx:id="browseBtn" text="Browse" disable="true" visible="false" onAction="#browseImage" />
                            <Label fx:id="selectedImageLabel" visible="false" />
                        </HBox>
                    </GridPane>

                    <HBox spacing="8">
                        <VBox.margin>
                            <Insets top="4" left="0" right="0" bottom="0" />
                        </VBox.margin>
                        <Button fx:id="editBtn" text="Edit Item" disable="true" visible="false" onAction="#toggleEdit" styleClass="primary-button" />
                        <Button fx:id="confirmBtn" text="Confirm" disable="true" visible="false" onAction="#confirmEdit" styleClass="success-button" />
                        <Button fx:id="cancelBtn" text="Cancel" disable="true" visible="false" onAction="#toggleEdit" styleClass="secondary-button" />
                    </HBox>

                    <!-- Delete Section -->
                    <VBox fx:id="deleteSection" spacing="6" styleClass="delete-section">
                        <VBox.margin>
                            <Insets top="2" left="0" right="0" bottom="0" />
                        </VBox.margin>
                        <Label fx:id="deleteLabel" text="Are you sure you want to delete this item?" textFill="RED" visible="false" managed="false" />
                        <HBox spacing="8">
                            <Button fx:id="checkDeleteBtn" text="Delete item" disable="true" visible="false" onAction="#toggleDelete" styleClass="danger-outline-button" />
                            <Button fx:id="deleteBtn" text="Delete" textFill="RED" disable="true" visible="false" onAction="#deleteItem" styleClass="danger-button" />
                            <Button fx:id="cancelDeleteBtn" text="Cancel" disable="true" visible="false" onAction="#toggleDelete" styleClass="secondary-button" />
                        </HBox>
                    </VBox>

                    <!-- Cart Section -->
                    <TitledPane text="Purchase" expanded="true" styleClass="cart-pane">
                        <content>
                            <VBox spacing="8" styleClass="cart-section">
                                <padding>
                                    <Insets top="8" right="10" bottom="10" left="10" />
                                </padding>
                                <Label fx:id="addToCartLabel" text="Add to Cart:" visible="true" styleClass="section-label" />
                                <HBox spacing="8" alignment="CENTER_LEFT">
                                    <Label fx:id="quantityLabel" text="Quantity:" visible="true" />
                                    <TextField fx:id="quantityField" text="1" prefWidth="70" visible="true" />
                                </HBox>
                                <Label fx:id="specialRequestsLabel" text="Special Requests:" visible="true" />
                                <TextArea fx:id="specialRequestsArea" promptText="Any special requests for this item..." wrapText="true" prefRowCount="3" visible="true" />
                                <HBox spacing="8">
                                    <Button fx:id="addToCartButton" text="Add to Cart" visible="true" onAction="#addToCart" styleClass="success-button" />
                                    <Button fx:id="viewCartButton" text="View Cart" visible="true" onAction="#viewCart" styleClass="primary-button" />
                                </HBox>
                            </VBox>
                        </content>
                    </TitledPane>
                </VBox>
            </HBox>

            <Region VBox.vgrow="ALWAYS" />
        </VBox>
    </children>
</AnchorPane>
